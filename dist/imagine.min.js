/*! imagine 0.0.1 */
BrowserUtils={browsers:{msie:"",chrome:"chrome",safari:"safari",firefox:"firefox",opera:"opera",other:"other"},getBrowserName:function(){var a=navigator.userAgent.toLowerCase();return a.indexOf("chrome")>0?BrowserUtils.browsers.chrome:a.indexOf("firefox")>=0?BrowserUtils.browsers.firefox:BrowserUtils.browsers.other},dataURItoBlob:function(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)])},writeText:function(a,b,c,d){for(var e,f,g,h=a.canvas.width,i=a.canvas.height,j=h-c,k=b.split(" "),l=[],m="",n=0;n<k.length;n++)e=m+k[n]+" ",f&&(g=f.width),f=a.measureText(e),f.width>j&&n>0?(l.push({text:m,x:h/2-g/2}),m=k[n]+" "):m=e;m.trim().length>0&&(f=a.measureText(m),l.push({text:m,x:h/2-f.width/2}));for(var o=d*l.length,p=i/2-o/2,q=0;q<l.length;q++){var r=l[q];a.fillText(r.text,r.x,p),p+=d}}};var ImageEditor=function(){var a,b,c,d,e,f,g=0,h=1,i={x:0,y:0},j={},k={},l=1,m=g,n=null,o=null,p=null,q=-1,r=-1,s=1,t=1,u=function(a){o.className.indexOf("hover")<0&&(o.className=o.className+" "+a)},v=function(a){a=a.trim();for(var b=o.className.split(" "),c="",d=0;d<b.length;d++)b[d].trim()!=a&&(c+=" "+b[d]);o.className=c},w=function(a){var b=new FileReader;b.onload=function(b){n=new Image;var c=o.getContext("2d");n.src=b.target.result,n.title=a.name,c.clearRect(0,0,o.width,o.height),l=1,i.x=o.width/2-n.width/2,i.y=o.height/2-n.height/2,c.drawImage(n,i.x,i.y,n.width,n.height),y(c,o)},b.readAsDataURL(a)},x=function(){if(null!==n){var a=this.getContext("2d"),b=n.width*l,c=n.height*l,d=i.x-(b-n.width)/2,e=i.y-(c-n.height)/2;a.clearRect(0,0,this.width,this.height),a.drawImage(n,d,e,b,c),y(a,this)}},y=function(a,b){a.globalAlpha=.5;var c=parseInt((b.width-q)/2),d=parseInt((b.height-r)/2);a.fillRect(0,0,b.width,d),a.fillRect(0,d,c,b.height-2*d),a.fillRect(0,b.height-d,b.width,d),a.fillRect(b.width-c,d,c,b.height-2*d),a.globalAlpha=1},z=function(){return n?{width:n.width,height:n.height}:null},A=function(){return n?{width:parseInt(n.width*l),height:parseInt(n.height*l)}:null},B=function(){var a={};return a.width=s?q*s:q,a.height=t?r*t:r,a},C=function(){return{x:s,y:t}},D=function(){return{width:q,height:r}},E=function(){return l},F=function(){if(n){var a={},b=parseInt((o.height-r)/2),c=parseInt((o.width-q)/2),d=z();return a.x=parseInt(-1*(i.x-c)+(d.width*l-d.width)/2),a.y=parseInt(-1*(i.y-b)+(d.height*l-d.height)/2),a}},G=function(c){var d=F(),e=D(),f=A(),g=d.x<0?0:d.x,h=d.y<0?0:d.y,i=-1*d.x+f.width,j=-1*d.y+f.height,k=i<e.width?f.width:f.width-(i-e.width),m=j<e.height?f.height:f.height-(j-e.height);w1_1=parseInt(k/l),h1_1=parseInt(m/l);var o=C(),p=d.x<0?-1*d.x:0,q=d.y<0?-1*d.y:0,r=k*o.x,s=m*o.y,t=e.width*o.x,u=e.height*o.y,v=document.createElement("canvas");v.width=t,v.height=u;var w=v.getContext("2d");return w.fillStyle=a,w.fillRect(0,0,t,u),w.drawImage(n,g/l,h/l,w1_1,h1_1,p*o.x,q*o.y,r,s),dataUrl=v.toDataURL("image/"+b,c),dataUrl},H=function(a,b,c){b||(b=1);var d=G(b),e=BrowserUtils.dataURItoBlob(d),f=new FormData;f.append("file",e);var g=new XMLHttpRequest;g.onreadystatechange=function(){4==g.readyState&&c(200==g.status?null:g.statusText)},g.open("POST",a,!0),g.send(f)},I=function(a,b){var c=new FormData;c.append("file",n);var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&b(200==d.status?null:d.statusText)},d.open("POST",a,!0),d.send(c)},J=function(){if(!n&&e){var a=o.getContext("2d");a.font=d,a.fillStyle=c,BrowserUtils.writeText(a,e,10,f)}},K=function(a){var b;if(m==h){var c={};c.x=k.x-a.clientX,c.y=k.y-a.clientY,i.x=j.x-c.x,i.y=j.y-c.y,b=document.createEvent("Event"),b.initEvent("imageRepositioned",!0,!1),o.dispatchEvent(b)}},L=function(a){m==g&&(k.x=a.clientX,k.y=a.clientY,j.x=i.x,j.y=i.y,window.addEventListener("mousemove",K),window.addEventListener("mouseup",M),m=h)},M=function(){m==h&&(window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",M),m=g)},N=function(a){var b=Math.max(-1,Math.min(a.wheelDelta||-a.detail));b>0&&(b=1),l+=3*b/100;var c=document.createEvent("Event");c.initEvent("imageScale",!0,!1),o.dispatchEvent(c)},O=function(){if(!o)throw"The element must be provided";p?(q=p.windowWidth?p.windowWidth:o.getAttribute("data-window-width")?parseInt(o.getAttribute("data-window-width")):o.width,r=p.windowHeight?p.windowHeight:o.getAttribute("data-window-height")?parseInt(o.getAttribute("data-window-height")):o.height,s=p.scaleX?p.scaleX:o.getAttribute("data-scale-x")?parseFloat(o.getAttribute("data-scale-x")):1,t=p.scaleY?p.scaleY:o.getAttribute("data-scale-y")?parseFloat(o.getAttribute("data-scale-y")):1,a=p.backgroundColor?p.backgroundColor:o.getAttribute("data-background-color")?o.getAttribute("data-background-color"):null,b=p.outputFormat?p.outputFormat:o.getAttribute("data-output-format")?o.getAttribute("data-output-format"):"jpeg",e=p.placeholder?p.placeholder:o.getAttribute("placeholder")?o.getAttribute("placeholder"):"",d=p.font?p.font:o.getAttribute("data-font")?o.getAttribute("font"):"20px Georgia",c=p.color?p.color:o.getAttribute("data-color")?o.getAttribute("data-color"):"#000000",f=p.lineHeight?p.lineHeight:parseInt(o.getAttribute("data-line-height"))?parseInt(o.getAttribute("data-line-height")):20):(q=o.getAttribute("data-window-width")?parseInt(o.getAttribute("data-window-width")):o.width,r=o.getAttribute("data-window-height")?parseInt(o.getAttribute("data-window-height")):o.height,s=o.getAttribute("data-scale-x")?parseFloat(o.getAttribute("data-scale-x")):1,t=o.getAttribute("data-scale-y")?parseFloat(o.getAttribute("data-scale-y")):1,a=o.getAttribute("data-background-color")?o.getAttribute("data-background-color"):null,b=o.getAttribute("data-output-format")?o.getAttribute("data-output-format"):"jpeg",e=o.getAttribute("placeholder")?o.getAttribute("placeholder"):"",d=o.getAttribute("data-font")?o.getAttribute("data-font"):"20px Georgia",c=o.getAttribute("data-color")?o.getAttribute("data-color"):"#000000",f=o.getAttribute("data-line-height")?parseInt(o.getAttribute("data-line-height")):20),a&&(o.style.backgroundColor=a),J(),o.ondragover=function(){return u("hover"),!1},o.ondragleave=function(){v("hover")},o.ondrop=function(a){a.preventDefault(),v("hover"),a.dataTransfer.files&&w(a.dataTransfer.files[0])},o.onmousedown=L,BrowserUtils.getBrowserName()==BrowserUtils.browsers.firefox?o.addEventListener("DOMMouseScroll",N):o.onmousewheel=N,o.addEventListener("imageScale",x),o.addEventListener("imageRepositioned",x)};return 0===arguments.length||("object"==typeof arguments[0]?p=arguments[0]:"string"==typeof arguments[0]&&(o=document.getElementById(arguments[0]),arguments.length>1&&(p=arguments[1]))),O(),{getOutput:G,getInputSize:z,getCurrentOffset:F,getOutputSize:B,getWindowSize:D,getCurrentFactor:E,getScale:C,sendOutput:H,sendInput:I}};